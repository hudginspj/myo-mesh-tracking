<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Usher REST API | Home</title>

<script type="text/javascript" src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Style sheet -->

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}" media="screen" />

</head>

<body>
	<div id="main">
		<a href="home.html" class="btn btn-secondary" id="menu-toggle">Menu</a>
		<h1>Security monitoring screen</h1>
        <table>
                <thead>
                    <tr>
                    <th>#</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Organization</th>
                    <th>Destination</th>
                    <th>Status</th>
                    <th>Sector</th>
                    </tr>
                </thead>
                <tbody>
                    <script>        
                            function changeColor(status){
                                let row = document.getElementById("one");

                                if (status == "good") {
                                    row.style.backgroundColor = "aquamarine";
                                } else if (status == "offline") {
                                    row.style.backgroundColor = "yellow";
                                } else if (status == "removed") {
                                    row.style.backgroundColor = "red";
                                } else if (status == "offline") {
                                    row.style.backgroundColor = "red";
                                } else {
                                    row.style.backgroundColor = "grey";
                                }
                            }
                        </script>
                    <tr id="one">
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>Google</td>
                    <td>Lunch Room</td>
                    <td id="here" onchange="changeColor()"></td>
                    <td id="there" onchange="changeColor()"></td>
                    </tr>
                    <tr id="two" bgcolor="green">
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>QualComm</td>
                    <td>2nd floor Computer Lab</td>
                    <td>good</td>
                    <td>2</td>
                    </tr>
                    <tr id="three" bgcolor="green">
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>Usher</td>
                    <td>1st floor Conference Room</td>
                    <td>good</td>
                    <td>4</td>
                    </tr>
                    <tr id="four" bgcolor="green">
                    <th scope="row">4</th>
                    <td>John</td>
                    <td>Doe</td>
                    <td>MicroSecurity</td>
                    <td>1st floor Bathroom</td>
                    <td>good</td>
                    <td>1</td>
                    </tr>
                </tbody>
            </table>
	</div>
</body>

<script type="text/javascript">
	//console.log('hello');
	function sleep(ms) {
	  return new Promise(resolve => setTimeout(resolve, ms));
	}
	async function loop() {
		var count = 0;
		while (1){
			//console.log(count);
			//count++;
			getUpdate()
			await sleep(2000);
		}
	}

	function getUpdate() {
		//console.log("getUpdate...")
		$.ajax(
		{
			url: "/updateMesh",
			dataType: "json"
		})
		.done(function(data)
		{
			doUpdate(data['sector'], data['status'])

		})
	}

	function doUpdate(sector, status) {
        let element0 = document.getElementById("here");
        element0.innerHTML = status;
        let element1 = document.getElementById("there");
        element1.innerHTML = String(sector);

	}

	loop();
</script>

</html>
